!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@bsv/sdk"),require("satoshi-token"),require("sigma-protocol"),require("image-meta")):"function"==typeof define&&define.amd?define(["exports","@bsv/sdk","satoshi-token","sigma-protocol","image-meta"],r):r((t||self).js1SatOrd={},t.bsv,t.satoshiToken,t.sigmaProtocol,t.imageMeta)}(this,function(t,r,n,e,o){function i(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=Array(r);n<r;n++)e[n]=t[n];return e}function a(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return i(t,r);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(){return s=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)({}).hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},s.apply(null,arguments)}function u(t,r){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},u(t,r)}var c,f,d,l,h=function(t){return Buffer.from(t).toString("hex")},p="1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5",v=10,y="https://ordinals.gorillapool.io/api",m=/*#__PURE__*/function(t){function n(){return t.apply(this,arguments)||this}var e,o;return o=t,(e=n).prototype=Object.create(o.prototype),e.prototype.constructor=e,u(e,o),n.prototype.lock=function(t,n,e){var o=(new r.P2PKH).lock(t);return g(o,n,e)},n}(r.P2PKH),g=function(t,n,e,o){void 0===o&&(o=!1);var i="";if(void 0!==(null==n?void 0:n.dataB64)&&void 0!==(null==n?void 0:n.contentType)){var a=h("ord"),s=Buffer.from(n.dataB64,"base64").toString("hex").trim();if(!s)throw new Error("Invalid file data");var u=h(n.contentType);if(!u)throw new Error("Invalid media type");i="OP_0 OP_IF "+a+" OP_1 "+u+" OP_0 "+s+" OP_ENDIF"}var c=(i?i+" "+(o?"OP_CODESEPARATOR ":""):"")+t.toASM();if(e&&(!e.app||!e.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=e&&e.app&&null!=e&&e.type){c=(c?c+" ":"")+"OP_RETURN "+h(p)+" "+h("SET");for(var f=0,d=Object.entries(e);f<d.length;f++){var l=d[f],v=l[0],y=l[1];"cmd"!==v&&(c=c+" "+h(v)+" "+h(y))}}return r.LockingScript.fromASM(c)};t.TokenSelectionStrategy=void 0,(c=t.TokenSelectionStrategy||(t.TokenSelectionStrategy={})).SmallestFirst="smallest",c.LargestFirst="largest",c.RetainOrder="retain",c.Random="random",t.TokenType=void 0,(f=t.TokenType||(t.TokenType={})).BSV20="bsv20",f.BSV21="bsv21",t.RoytaltyType=void 0,(d=t.RoytaltyType||(t.RoytaltyType={})).Paymail="paymail",d.Address="address",d.Script="script",t.TokenInputMode=void 0,(l=t.TokenInputMode||(t.TokenInputMode={})).All="all",l.Needed="needed";var w=Math.pow(2n,64n)-1n,b=r.Utils.fromBase58Check,k=function(t,n){return r.fromUtxo(s({},t,{script:Buffer.from(t.script,"base64").toString("hex")}),n)},P=function(t,r){try{var n,o=function(t){if(n)return t;throw new Error("Signer must be a LocalSigner or RemoteSigner")},i=null==r?void 0:r.idKey,a=null==r?void 0:r.keyHost;if(i){var s=new e.Sigma(t).sign(i);return Promise.resolve(s.signedTx)}var u=function(){if(a){var o=null==r?void 0:r.authToken,i=new e.Sigma(t);return function(t,r){try{var e=Promise.resolve(i.remoteSign(a,o)).then(function(t){return n=1,t.signedTx})}catch(t){return r(t)}return e&&e.then?e.then(void 0,r):e}(0,function(t){throw console.log(t),new Error("Remote signing to "+a+" failed")})}}();return Promise.resolve(u&&u.then?u.then(o):o(u))}catch(t){return Promise.reject(t)}},S=function(t){if(t){for(var r={app:t.app,type:t.type},n=0,e=Object.entries(t);n<e.length;n++){var o=e[n],i=o[1];void 0!==i&&(r[o[0]]="string"==typeof i?i:Array.isArray(i)||"object"==typeof i?JSON.stringify(i):String(i))}return r}};const I="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function x(t,r,n){if(!t.s){if(n instanceof T){if(!n.s)return void(n.o=x.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(x.bind(null,t,r),x.bind(null,t,2));t.s=r,t.v=n;var e=t.o;e&&e(t)}}var T=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,n){var e=new t,o=this.s;if(o){var i=1&o?r:n;if(i){try{x(e,1,i(this.v))}catch(t){x(e,2,t)}return e}return this}return this.o=function(t){try{var o=t.v;1&t.s?x(e,1,r?r(o):o):n?x(e,1,n(o)):x(e,2,o)}catch(t){x(e,2,t)}},e},t}();function B(t){return t instanceof T&&1&t.s}const O="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function E(t,r,n){if(!t.s){if(n instanceof A){if(!n.s)return void(n.o=E.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(E.bind(null,t,r),E.bind(null,t,2));t.s=r,t.v=n;var e=t.o;e&&e(t)}}var A=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,n){var e=new t,o=this.s;if(o){var i=1&o?r:n;if(i){try{E(e,1,i(this.v))}catch(t){E(e,2,t)}return e}return this}return this.o=function(t){try{var o=t.v;1&t.s?E(e,1,r?r(o):o):n?E(e,1,n(o)):E(e,2,o)}catch(t){E(e,2,t)}},e},t}();function N(t){return t instanceof A&&1&t.s}const K="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function U(t,r,n){if(!t.s){if(n instanceof j){if(!n.s)return void(n.o=U.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(U.bind(null,t,r),U.bind(null,t,2));t.s=r,t.v=n;var e=t.o;e&&e(t)}}var j=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,n){var e=new t,o=this.s;if(o){var i=1&o?r:n;if(i){try{U(e,1,i(this.v))}catch(t){U(e,2,t)}return e}return this}return this.o=function(t){try{var o=t.v;1&t.s?U(e,1,r?r(o):o):n?U(e,1,n(o)):U(e,2,o)}catch(t){U(e,2,t)}},e},t}();function q(t){return t instanceof j&&1&t.s}const H="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function _(t,r,n){if(!t.s){if(n instanceof C){if(!n.s)return void(n.o=_.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(_.bind(null,t,r),_.bind(null,t,2));t.s=r,t.v=n;var e=t.o;e&&e(t)}}var C=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,n){var e=new t,o=this.s;if(o){var i=1&o?r:n;if(i){try{_(e,1,i(this.v))}catch(t){_(e,2,t)}return e}return this}return this.o=function(t){try{var o=t.v;1&t.s?_(e,1,r?r(o):o):n?_(e,1,n(o)):_(e,2,o)}catch(t){_(e,2,t)}},e},t}();function L(t){return t instanceof C&&1&t.s}var R=/*#__PURE__*/function(){function t(){}var n=t.prototype;return n.lock=function(n,e,o,i){var a=r.Utils.fromBase58Check(n).data,s=r.Utils.fromBase58Check(e).data,u=new r.Script;if(void 0!==(null==i?void 0:i.dataB64)&&void 0!==(null==i?void 0:i.contentType)){var c=h("ord"),f=Buffer.from(i.dataB64,"base64").toString("hex").trim();if(!f)throw new Error("Invalid file data");var d=h(i.contentType);if(!d)throw new Error("Invalid media type");u=r.Script.fromASM("OP_0 OP_IF "+c+" OP_1 "+d+" OP_0 "+f+" OP_ENDIF")}return u.writeScript(r.Script.fromHex("2097dfd76851bf465e8f715593b217714858bbe9570ff3bd5e33840a34e20ff0262102ba79df5f8ae7604a9830f03c7933028186aede0675a16f025dc4f8be8eec0382201008ce7480da41702918d1ec8e6849ba32b4d65b1e40dc669c31a1e6306b266c0000")).writeBin(a).writeBin(t.buildOutput(o,(new r.P2PKH).lock(s).toBinary())).writeScript(r.Script.fromHex("615179547a75537a537a537a0079537a75527a527a7575615579008763567901c161517957795779210ac407f0e4bd44bfc207355a778b046225a7068fc59ee7eda43ad905aadbffc800206c266b30e6a1319c66dc401e5bd6b432ba49688eecd118297041da8074ce081059795679615679aa0079610079517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e01007e81517a75615779567956795679567961537956795479577995939521414136d08c5ed2bf3ba048afe6dcaebafeffffffffffffffffffffffffffffff00517951796151795179970079009f63007952799367007968517a75517a75517a7561527a75517a517951795296a0630079527994527a75517a6853798277527982775379012080517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f517f7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e7c7e01205279947f7754537993527993013051797e527e54797e58797e527e53797e52797e57797e0079517a75517a75517a75517a75517a75517a75517a75517a75517a75517a75517a75517a75517a756100795779ac517a75517a75517a75517a75517a75517a75517a75517a75517a7561517a75517a756169587951797e58797eaa577961007982775179517958947f7551790128947f77517a75517a75618777777777777777777767557951876351795779a9876957795779ac777777777777777767006868"))},n.cancelListing=function(t,n,e,o,i){void 0===n&&(n="all"),void 0===e&&(e=!1);var a=(new r.P2PKH).unlock(t,n,e,o,i);return{sign:function(t,n){try{return Promise.resolve(a.sign(t,n)).then(function(t){return t.writeOpCode(r.OP.OP_1)})}catch(t){return Promise.reject(t)}},estimateLength:function(){return Promise.resolve(107)}}},n.purchaseListing=function(n,e){var o={sign:function(o,i){try{var s;if(o.outputs.length<2)throw new Error("Malformed transaction");var u=(new r.UnlockingScript).writeBin(t.buildOutput(o.outputs[0].satoshis||0,o.outputs[0].lockingScript.toBinary()));if(o.outputs.length>2){for(var c,f=new r.Utils.Writer,d=a(o.outputs.slice(2));!(c=d()).done;){var l=c.value;f.write(t.buildOutput(l.satoshis||0,l.lockingScript.toBinary()))}u.writeBin(f.toArray())}else u.writeOpCode(r.OP.OP_0);var h=o.inputs[i],p=n;if(!p&&h.sourceTransaction)p=h.sourceTransaction.outputs[h.sourceOutputIndex].satoshis;else if(!n)throw new Error("sourceTransaction or sourceSatoshis is required");var v,y=h.sourceTXID||(null==(s=h.sourceTransaction)?void 0:s.id("hex")),m=e;m||(m=null==(v=h.sourceTransaction)?void 0:v.outputs[h.sourceOutputIndex].lockingScript);var g=r.TransactionSignature.format({sourceTXID:y,sourceOutputIndex:h.sourceOutputIndex,sourceSatoshis:p,transactionVersion:o.version,otherInputs:[],inputIndex:i,outputs:o.outputs,inputSequence:h.sequence,subscript:m,lockTime:o.lockTime,scope:r.TransactionSignature.SIGHASH_ALL|r.TransactionSignature.SIGHASH_ANYONECANPAY|r.TransactionSignature.SIGHASH_FORKID});return Promise.resolve(u.writeBin(g).writeOpCode(r.OP.OP_0))}catch(t){return Promise.reject(t)}},estimateLength:function(t,r){try{return Promise.resolve(o.sign(t,r)).then(function(t){return t.toBinary().length})}catch(t){return Promise.reject(t)}}};return o},t.buildOutput=function(t,n){var e=new r.Utils.Writer;return e.writeUInt64LEBn(new r.BigNumber(t)),e.writeVarIntNum(n.length),e.write(n),e.toArray()},t}(),D="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function F(t,r,n){if(!t.s){if(n instanceof M){if(!n.s)return void(n.o=F.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(F.bind(null,t,r),F.bind(null,t,2));t.s=r,t.v=n;var e=t.o;e&&e(t)}}var M=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,n){var e=new t,o=this.s;if(o){var i=1&o?r:n;if(i){try{F(e,1,i(this.v))}catch(t){F(e,2,t)}return e}return this}return this.o=function(t){try{var o=t.v;1&t.s?F(e,1,r?r(o):o):n?F(e,1,n(o)):F(e,2,o)}catch(t){F(e,2,t)}},e},t}();function V(t){return t instanceof M&&1&t.s}var J=r.Utils.toArray;function X(t,r,n){if("function"==typeof t[D]){var e,o,i,a=t[D]();if(function t(s){try{for(;!((e=a.next()).done||n&&n());)if((s=r(e.value))&&s.then){if(!V(s))return void s.then(t,i||(i=F.bind(null,o=new M,2)));s=s.v}o?F(o,1,s):o=s}catch(t){F(o||(o=new M),2,t)}}(),a.return){var s=function(t){try{e.done||a.return()}catch(t){}return t};if(o&&o.then)return o.then(s,function(t){throw s(t)});s()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var u=[],c=0;c<t.length;c++)u.push(t[c]);return function(t,r,n){var e,o,i=-1;return function a(s){try{for(;++i<t.length&&(!n||!n());)if((s=r(i))&&s.then){if(!V(s))return void s.then(a,o||(o=F.bind(null,e=new M,2)));s=s.v}e?F(e,1,s):e=s}catch(t){F(e||(e=new M),2,t)}}(),e}(u,function(t){return r(u[t])},n)}const W="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function G(t,r,n){if(!t.s){if(n instanceof Y){if(!n.s)return void(n.o=G.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(G.bind(null,t,r),G.bind(null,t,2));t.s=r,t.v=n;var e=t.o;e&&e(t)}}var Y=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,n){var e=new t,o=this.s;if(o){var i=1&o?r:n;if(i){try{G(e,1,i(this.v))}catch(t){G(e,2,t)}return e}return this}return this.o=function(t){try{var o=t.v;1&t.s?G(e,1,r?r(o):o):n?G(e,1,n(o)):G(e,2,o)}catch(t){G(e,2,t)}},e},t}();function Q(t){return t instanceof Y&&1&t.s}function $(t,r,n){if("function"==typeof t[W]){var e,o,i,a=function(t){try{for(;!((e=s.next()).done||n&&n());)if((t=r(e.value))&&t.then){if(!Q(t))return void t.then(a,i||(i=G.bind(null,o=new Y,2)));t=t.v}o?G(o,1,t):o=t}catch(t){G(o||(o=new Y),2,t)}},s=t[W]();if(a(),s.return){var u=function(t){try{e.done||s.return()}catch(t){}return t};if(o&&o.then)return o.then(u,function(t){throw u(t)});u()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<t.length;f++)c.push(t[f]);return function(t,r,n){var e,o,i=-1;return function a(s){try{for(;++i<t.length&&(!n||!n());)if((s=r(i))&&s.then){if(!Q(s))return void s.then(a,o||(o=G.bind(null,e=new Y,2)));s=s.v}e?G(e,1,s):e=s}catch(t){G(e||(e=new Y),2,t)}}(),e}(c,function(t){return r(c[t])},n)}function z(t,r,n){if(!t.s){if(n instanceof Z){if(!n.s)return void(n.o=z.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(z.bind(null,t,r),z.bind(null,t,2));t.s=r,t.v=n;const e=t.o;e&&e(t)}}var Z=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,n){var e=new t,o=this.s;if(o){var i=1&o?r:n;if(i){try{z(e,1,i(this.v))}catch(t){z(e,2,t)}return e}return this}return this.o=function(t){try{var o=t.v;1&t.s?z(e,1,r?r(o):o):n?z(e,1,n(o)):z(e,2,o)}catch(t){z(e,2,t)}},e},t}(),tt="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function rt(t){return t instanceof Z&&1&t.s}function nt(t,r,n){if("function"==typeof t[tt]){var e,o,i,a=function(t){try{for(;!((e=s.next()).done||n&&n());)if((t=r(e.value))&&t.then){if(!rt(t))return void t.then(a,i||(i=z.bind(null,o=new Z,2)));t=t.v}o?z(o,1,t):o=t}catch(t){z(o||(o=new Z),2,t)}},s=t[tt]();if(a(),s.return){var u=function(t){try{e.done||s.return()}catch(t){}return t};if(o&&o.then)return o.then(u,function(t){throw u(t)});u()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<t.length;f++)c.push(t[f]);return function(t,r,n){var e,o,i=-1;return function a(s){try{for(;++i<t.length&&(!n||!n());)if((s=r(i))&&s.then){if(!rt(s))return void s.then(a,o||(o=z.bind(null,e=new Z,2)));s=s.v}e?z(e,1,s):e=s}catch(t){z(e||(e=new Z),2,t)}}(),e}(c,function(t){return r(c[t])},n)}var et=r.Utils.toArray,ot=new Error("Image must be a square image with dimensions <= 400x400"),it=new Error("Image must be a square image"),at=new Error("Error processing image"),st=new Error("Image dimensions are undefined");const ut="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function ct(t,r,n){if(!t.s){if(n instanceof ft){if(!n.s)return void(n.o=ct.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(ct.bind(null,t,r),ct.bind(null,t,2));t.s=r,t.v=n;var e=t.o;e&&e(t)}}var ft=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(r,n){var e=new t,o=this.s;if(o){var i=1&o?r:n;if(i){try{ct(e,1,i(this.v))}catch(t){ct(e,2,t)}return e}return this}return this.o=function(t){try{var o=t.v;1&t.s?ct(e,1,r?r(o):o):n?ct(e,1,n(o)):ct(e,2,o)}catch(t){ct(e,2,t)}},e},t}();function dt(t){return t instanceof ft&&1&t.s}var lt=/*#__PURE__*/function(){function t(t){this.fetch=void 0,this.fetch=t}return t.prototype.request=function(t,r){try{var n={method:r.method,headers:r.headers,body:JSON.stringify(r.data)};return Promise.resolve(this.fetch.call(window,t,n)).then(function(t){var r=t.headers.get("Content-Type");return Promise.resolve(null!=r&&r.startsWith("application/json")?t.json():t.text()).then(function(r){return{ok:t.ok,status:t.status,statusText:t.statusText,data:r}})})}catch(t){return Promise.reject(t)}},t}(),ht=/*#__PURE__*/function(){function t(t){void 0===t&&(t=function(){var t={request:function(){try{throw new Error("No method available to perform HTTP request")}catch(t){return Promise.reject(t)}}};if("undefined"!=typeof window&&"function"==typeof window.fetch){var n=window.fetch;return window.fetch=function(){try{return Promise.resolve(n.apply(void 0,[].slice.call(arguments)))}catch(t){return Promise.reject(t)}},new lt(window.fetch)}if("undefined"==typeof require)return t;try{var e=require("node:https");return new r.NodejsHttpClient(e)}catch(r){return t}}()),this.URL=void 0,this.httpClient=void 0,this.URL=y+"/tx",this.httpClient=t}return t.prototype.broadcast=function(t){try{var n=this,e={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:{rawtx:r.Utils.toBase64(t.toBinary())}};return Promise.resolve(function(t,r){try{var o=Promise.resolve(n.httpClient.request(n.URL,e)).then(function(t){var r,n;return t.ok?{status:"success",txid:t.data,message:"broadcast successful"}:{status:"error",code:null!=(r=t.status.toString())?r:"ERR_UNKNOWN",description:null!=(n=t.data.message)?n:"Unknown error"}})}catch(t){return r(t)}return o&&o.then?o.then(void 0,r):o}(0,function(t){return{status:"error",code:"500",description:t instanceof Error?t.message:"Internal Server Error"}}))}catch(t){return Promise.reject(t)}},t}();t.MAX_TOKEN_SUPPLY=w,t.OneSatBroadcaster=ht,t.OrdLock=R,t.OrdP2PKH=m,t.applyInscription=g,t.burnOrdinals=function(t){try{for(var n,e=new r.Transaction,o=[],i=t.metaData,s=t.ordPk,u=a(t.ordinals);!(n=u()).done;){var c=n.value;if(1!==c.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var f=c.pk||s;if(!f)throw new Error("Private key is required to sign the ordinal");var d=k(c,(new m).unlock(f,"all",!0,c.satoshis,r.Script.fromBinary(r.Utils.toArray(c.script,"base64"))));o.push(c.txid+"_"+c.vout),e.addInput(d)}if(i&&(!i.app||!i.type))throw new Error("MAP.app and MAP.type are required fields");var l="";if(null!=i&&i.app&&null!=i&&i.type){l="OP_FALSE OP_RETURN "+h(p)+" "+h("SET");for(var v=0,y=Object.entries(i);v<y.length;v++){var g=y[v],w=g[0],b=g[1];"cmd"!==w&&(l=l+" "+h(w)+" "+h(b))}}return e.addOutput({satoshis:0,lockingScript:r.Script.fromASM(l||"OP_FALSE OP_RETURN")}),Promise.resolve(e.sign()).then(function(){return{tx:e,spentOutpoints:o}})}catch(t){return Promise.reject(t)}},t.cancelOrdListings=function(t){try{var n,e=function(t){if(O<E+BigInt(A))throw new Error("Not enough funds to cancel ordinal listings. Total sats in: "+O+", Total sats out: "+E+", Fee: "+A);return Promise.resolve(m.fee(y)).then(function(){return Promise.resolve(m.sign()).then(function(){var t=m.outputs.findIndex(function(t){return t.change});if(-1!==t){var r=m.outputs[t];p={satoshis:r.satoshis,txid:m.id("hex"),vout:t,script:Buffer.from(r.lockingScript.toBinary()).toString("base64")}}return p&&(p.satoshis=m.outputs[m.outputs.length-1].satoshis,p.txid=m.id("hex")),{tx:m,spentOutpoints:m.inputs.map(function(t){return t.sourceTXID+"_"+t.sourceOutputIndex}),payChange:p}})})},o=t.utxos,i=t.listingUtxos,s=t.ordPk,u=t.paymentPk,c=t.additionalPayments,f=void 0===c?[]:c,d=t.satsPerKb,l=void 0===d?v:d;i.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var h,p,y=new r.SatoshisPerKilobyte(l),m=new r.Transaction,g=a(i);!(h=g()).done;){var w=h.value,b=w.pk||s;if(!b)throw new Error("Private key required for token input");m.addInput(k(w,(new R).cancelListing(b,"all",!0,w.satoshis,r.Script.fromBinary(r.Utils.toArray(w.script,"base64"))))),m.addOutput({satoshis:1,lockingScript:(new r.P2PKH).lock(b.toAddress().toString())})}for(var P,S=a(f);!(P=S()).done;){var I=P.value;m.addOutput({satoshis:I.amount,lockingScript:(new r.P2PKH).lock(I.to)})}var x=t.changeAddress||(null==u?void 0:u.toAddress());if(!x)throw new Error("paymentPk or changeAddress required for payment change");var T=x,B=(new r.P2PKH).lock(T);m.addOutput({lockingScript:B,change:!0});var O=0n,E=m.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),A=0,N=$(o,function(t){var e=t.pk||u;if(!e)throw new Error("paymentPk required for payment utxo");var o=k(t,(new r.P2PKH).unlock(e,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return m.addInput(o),O+=BigInt(t.satoshis),Promise.resolve(y.computeFee(m)).then(function(t){A=t,O>=E+BigInt(A)&&(n=1)})},function(){return n||void 0});return Promise.resolve(N&&N.then?N.then(e):e())}catch(t){return Promise.reject(t)}},t.cancelOrdTokenListings=function(n){try{var e,o=function(t){if(_<C+BigInt(L))throw new Error("Not enough funds to cancel token listings. Total sats in: "+_+", Total sats out: "+C+", Fee: "+L);return Promise.resolve(P.fee(b)).then(function(){return Promise.resolve(P.sign()).then(function(){var t=[{amt:g.toString(),script:Buffer.from(N.toHex(),"hex").toString("base64"),txid:P.id("hex"),vout:0,id:u,satoshis:1}],r=P.outputs.findIndex(function(t){return t.change});if(-1!==r){var n=P.outputs[r];E={satoshis:n.satoshis,txid:P.id("hex"),vout:r,script:Buffer.from(n.lockingScript.toBinary()).toString("base64")}}return E&&(E.satoshis=P.outputs[P.outputs.length-1].satoshis,E.txid=P.id("hex")),{tx:P,spentOutpoints:P.inputs.map(function(t){return t.sourceTXID+"_"+t.sourceOutputIndex}),payChange:E,tokenChange:t}})})},i=n.protocol,u=n.tokenID,c=n.paymentPk,f=n.ordPk,d=n.additionalPayments,l=n.listingUtxos,h=n.utxos,p=n.satsPerKb,y=void 0===p?v:p,g=0;if(l.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead."),!l.every(function(t){return t.id===u}))throw new Error("Input tokens do not match the provided tokenID");for(var w,b=new r.SatoshisPerKilobyte(y),P=new r.Transaction,S=a(l);!(w=S()).done;){var I=w.value,x=I.pk||f;if(!x)throw new Error("Private key required for token input");P.addInput(k(I,(new R).cancelListing(x,"all",!0,I.satoshis,r.Script.fromBinary(r.Utils.toArray(I.script,"base64"))))),g+=Number.parseInt(I.amt)}var T,B={p:"bsv-20",op:"transfer",amt:g.toString()};if(i===t.TokenType.BSV20)T=s({},B,{tick:u});else{if(i!==t.TokenType.BSV21)throw new Error("Invalid protocol");T=s({},B,{id:u})}var O=n.ordAddress||(null==f?void 0:f.toAddress());if(!O)throw new Error("ordAddress or ordPk required for token output");var E,A={address:O,inscription:{dataB64:Buffer.from(JSON.stringify(T)).toString("base64"),contentType:"application/bsv-20"}},N=(new m).lock(A.address,A.inscription);P.addOutput({satoshis:1,lockingScript:N});for(var K,U=a(d);!(K=U()).done;){var j=K.value;P.addOutput({satoshis:j.amount,lockingScript:(new r.P2PKH).lock(j.to)})}var q=n.changeAddress||(null==c?void 0:c.toAddress());if(!q)throw new Error("paymentPk or changeAddress required for payment change");var H=(new r.P2PKH).lock(q);P.addOutput({lockingScript:H,change:!0});var _=0n,C=P.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),L=0,D=$(h,function(t){var n=t.pk||c;if(!n)throw new Error("paymentPk required for payment utxo");var o=k(t,(new r.P2PKH).unlock(n,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return P.addInput(o),_+=BigInt(t.satoshis),Promise.resolve(b.computeFee(P)).then(function(t){L=t,_>=C+BigInt(L)&&(e=1)})},function(){return e||void 0});return Promise.resolve(D&&D.then?D.then(o):o())}catch(t){return Promise.reject(t)}},t.createOrdListings=function(t){try{var n,e,o=function(t){if(E<A+BigInt(N))throw new Error("Not enough funds to create ordinal listings. Total sats in: "+E+", Total sats out: "+A+", Fee: "+N);return Promise.resolve(p.fee(h)).then(function(){return Promise.resolve(p.sign()).then(function(){var t=p.outputs.findIndex(function(t){return t.change});if(-1!==t){var r=p.outputs[t];e={satoshis:r.satoshis,txid:p.id("hex"),vout:t,script:Buffer.from(r.lockingScript.toBinary()).toString("base64")}}return e&&(e.satoshis=p.outputs[p.outputs.length-1].satoshis,e.txid=p.id("hex")),{tx:p,spentOutpoints:p.inputs.map(function(t){return t.sourceTXID+"_"+t.sourceOutputIndex}),payChange:e}})})},i=t.utxos,s=t.listings,u=t.paymentPk,c=t.ordPk,f=t.satsPerKb,d=t.additionalPayments,l=void 0===d?[]:d,h=new r.SatoshisPerKilobyte(void 0===f?v:f),p=new r.Transaction;s.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var y,g=a(s);!(y=g()).done;){var w=y.value;p.addOutput({satoshis:1,lockingScript:(new R).lock(w.ordAddress,w.payAddress,w.price)});var b=J(w.listingUtxo.script,"base64"),P=r.Script.fromBinary(b),S=w.listingUtxo.pk||c;if(!S)throw new Error("Private key is required to sign the ordinal");p.addInput(k(w.listingUtxo,(new m).unlock(S,"all",!0,w.listingUtxo.satoshis,P)))}for(var I,x=a(l);!(I=x()).done;){var T=I.value;p.addOutput({satoshis:T.amount,lockingScript:(new r.P2PKH).lock(T.to)})}var B=t.changeAddress||(null==u?void 0:u.toAddress());if(!B)throw new Error("changeAddress or private key is required");var O=(new r.P2PKH).lock(B);p.addOutput({lockingScript:O,change:!0});var E=0n,A=p.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),N=0,K=X(i,function(t){var e=t.pk||u;if(!e)throw new Error("Private key is required to sign the transaction");var o=k(t,(new r.P2PKH).unlock(e,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return p.addInput(o),E+=BigInt(t.satoshis),Promise.resolve(h.computeFee(p)).then(function(t){N=t,E>=A+BigInt(N)&&(n=1)})},function(){return n||void 0});return Promise.resolve(K&&K.then?K.then(o):o())}catch(t){return Promise.reject(t)}},t.createOrdTokenListings=function(e){try{var o,i=function(t){if(Z<tt+BigInt(rt))throw new Error("Not enough funds to create token listings. Total sats in: "+Z+", Total sats out: "+tt+", Fee: "+rt);return Promise.resolve(N.fee(A)).then(function(){return Promise.resolve(N.sign()).then(function(){var t=N.id("hex");O&&(O=O.map(function(r){return s({},r,{txid:t})}));var r=N.outputs.findIndex(function(t){return t.change});if(-1!==r){var n=N.outputs[r];E={satoshis:n.satoshis,txid:t,vout:r,script:Buffer.from(n.lockingScript.toBinary()).toString("base64")}}return E&&(E.satoshis=N.outputs[N.outputs.length-1].satoshis,E.txid=N.id("hex")),{tx:N,spentOutpoints:N.inputs.map(function(t){return t.sourceTXID+"_"+t.sourceOutputIndex}),payChange:E,tokenChange:O}})})},u=e.utxos,c=e.protocol,f=e.tokenID,d=e.ordPk,l=e.paymentPk,h=e.additionalPayments,p=void 0===h?[]:h,y=e.tokenChangeAddress,g=e.inputTokens,w=e.listings,b=e.decimals,P=e.satsPerKb,S=void 0===P?v:P;if(w.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead."),!g.every(function(t){return t.id===f}))throw new Error("Input tokens do not match the provided tokenID");var I=0n,x=0n,T=0n;if(!g.every(function(t){return t.id===f}))throw new Error("Input tokens do not match the provided tokenID");for(var B,O,E,A=new r.SatoshisPerKilobyte(S),N=new r.Transaction,K=a(w);!(B=K()).done;){var U=B.value,j=n.toTokenSat(U.tokens,b,n.ReturnTypes.BigInt),q={p:"bsv-20",op:"transfer",amt:j.toString()},H=void 0;if(c===t.TokenType.BSV20)H=s({},q,{tick:f});else{if(c!==t.TokenType.BSV21)throw new Error("Invalid protocol");H=s({},q,{id:f})}N.addOutput({satoshis:1,lockingScript:(new R).lock(U.ordAddress,U.payAddress,U.price,{dataB64:Buffer.from(JSON.stringify(H)).toString("base64"),contentType:"application/bsv-20"})}),T+=j}for(var _,C=a(g);!(_=C()).done;){var L=_.value,D=L.pk||d;if(!D)throw new Error("Private key is required to sign the ordinal");N.addInput(k(L,(new m).unlock(D,"all",!0,L.satoshis,r.Script.fromBinary(J(L.script,"base64"))))),x+=BigInt(L.amt)}if((I=x-T)<0n)throw new Error("Not enough tokens to send");if(I>0n){var F,M={p:"bsv-20",op:"transfer",amt:I.toString()};if(c===t.TokenType.BSV20)F=s({},M,{tick:f});else{if(c!==t.TokenType.BSV21)throw new Error("Invalid protocol");F=s({},M,{id:f})}var V=(new m).lock(y,{dataB64:Buffer.from(JSON.stringify(F)).toString("base64"),contentType:"application/bsv-20"}),W=N.outputs.length;N.addOutput({lockingScript:V,satoshis:1}),O=[{id:f,satoshis:1,script:Buffer.from(V.toBinary()).toString("base64"),txid:"",vout:W,amt:I.toString()}]}for(var G,Y=a(p);!(G=Y()).done;){var Q=G.value;N.addOutput({satoshis:Q.amount,lockingScript:(new r.P2PKH).lock(Q.to)})}var $=e.changeAddress||(null==l?void 0:l.toAddress());if(!$)throw new Error("Either changeAddress or paymentPk is required");var z=(new r.P2PKH).lock($);N.addOutput({lockingScript:z,change:!0});var Z=0n,tt=N.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),rt=0,nt=X(u,function(t){var n=t.pk||l;if(!n)throw new Error("Private key is required to sign the payment");var e=k(t,(new r.P2PKH).unlock(n,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return N.addInput(e),Z+=BigInt(t.satoshis),Promise.resolve(A.computeFee(N)).then(function(t){rt=t,Z>=tt+BigInt(rt)&&(o=1)})},function(){return o||void 0});return Promise.resolve(nt&&nt.then?nt.then(i):i())}catch(t){return Promise.reject(t)}},t.createOrdinals=function(t){try{var n=function(t){var n;function o(t){if(H<_+BigInt(a))throw new Error("Not enough funds to create ordinals. Total sats in: "+H+", Total sats out: "+_+", Fee: "+a);return Promise.resolve(g.fee(y)).then(function(){return Promise.resolve(g.sign()).then(function(){var t=g.outputs.findIndex(function(t){return t.change});if(-1!==t){var r=g.outputs[t];p={satoshis:r.satoshis,txid:g.id("hex"),vout:t,script:Buffer.from(r.lockingScript.toBinary()).toString("base64")}}return p&&(p.satoshis=g.outputs[g.outputs.length-1].satoshis,p.txid=g.id("hex")),{tx:g,spentOutpoints:e.map(function(t){return t.txid+"_"+t.vout}),payChange:p}})})}var a=0,s=function(t,r,n){if("function"==typeof t[I]){var e,o,i,a=function(t){try{for(;!((e=s.next()).done||n&&n());)if((t=r(e.value))&&t.then){if(!B(t))return void t.then(a,i||(i=x.bind(null,o=new T,2)));t=t.v}o?x(o,1,t):o=t}catch(t){x(o||(o=new T),2,t)}},s=t[I]();if(a(),s.return){var u=function(t){try{e.done||s.return()}catch(t){}return t};if(o&&o.then)return o.then(u,function(t){throw u(t)});u()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<t.length;f++)c.push(t[f]);return function(t,r,n){var e,o,i=-1;return function a(s){try{for(;++i<t.length&&(!n||!n());)if((s=r(i))&&s.then){if(!B(s))return void s.then(a,o||(o=x.bind(null,e=new T,2)));s=s.v}e?x(e,1,s):e=s}catch(t){x(e||(e=new T),2,t)}}(),e}(c,function(t){return r(c[t])},n)}(e,function(t){var e=t.pk||i;if(!e)throw new Error("Private key is required to sign the transaction");if(!(H>=_+BigInt(a))){var o=k(t,(new r.P2PKH).unlock(e,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return g.addInput(o),H+=BigInt(t.satoshis),Promise.resolve(y.computeFee(g)).then(function(t){a=t})}n=1},function(){return n||void 0});return s&&s.then?s.then(o):o()},e=t.utxos,o=t.destinations,i=t.paymentPk,s=t.satsPerKb,u=void 0===s?v:s,c=t.metaData,f=t.signer,d=t.additionalPayments,l=void 0===d?[]:d;o.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var h,p,y=new r.SatoshisPerKilobyte(u),g=new r.Transaction,w=a(o);!(h=w()).done;){var b=h.value;if(!b.inscription)throw new Error("Inscription is required for all destinations");if(c)for(var O=0,E=Object.keys(c);O<E.length;O++){var A=E[O];void 0===c[A]&&delete c[A]}g.addOutput({satoshis:1,lockingScript:(new m).lock(b.address,b.inscription,S(c))})}for(var N,K=a(l);!(N=K()).done;){var U=N.value;g.addOutput({satoshis:U.amount,lockingScript:(new r.P2PKH).lock(U.to)})}var j=t.changeAddress||(null==i?void 0:i.toAddress());if(!j)throw new Error("Either changeAddress or paymentPk is required");var q=(new r.P2PKH).lock(j);g.addOutput({lockingScript:q,change:!0});var H=0n,_=g.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),C=function(){if(f){var t=e.pop(),n=t.pk||i;if(!n)throw new Error("Private key is required to sign the transaction");return g.addInput(k(t,(new r.P2PKH).unlock(n,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))))),H+=BigInt(t.satoshis),Promise.resolve(P(g,f)).then(function(t){g=t})}}();return Promise.resolve(C&&C.then?C.then(n):n())}catch(t){return Promise.reject(t)}},t.deployBsv21Token=function(t){try{var n,e=function(e){var o;function s(n){if(T<B+BigInt(O))throw new Error("Not enough funds to deploy token. Total sats in: "+T+", Total sats out: "+B+", Fee: "+O);var e,o=t.changeAddress||(null==d?void 0:d.toAddress());if(!o)throw new Error("Either changeAddress or paymentPk is required");var i=(new r.P2PKH).lock(o);return w.addOutput({lockingScript:i,change:!0}),Promise.resolve(w.fee(g)).then(function(){return Promise.resolve(w.sign()).then(function(){var t=w.outputs.findIndex(function(t){return t.change});if(-1!==t){var r=w.outputs[t];e={satoshis:r.satoshis,txid:w.id("hex"),vout:t,script:Buffer.from(r.lockingScript.toBinary()).toString("base64")}}return{tx:w,spentOutpoints:w.inputs.map(function(t){return t.sourceTXID+"_"+t.sourceOutputIndex}),payChange:e}})})}if(!function(t){if(!t.includes("_")||t.endsWith("_"))return!1;var r=Number.parseInt(t.split("_")[1]);return!(Number.isNaN(r)||!t.startsWith("_")&&64!==t.split("_")[0].length)}(n))throw new Error("Invalid icon format. Must be either outpoint (format: txid_vout) or relative output index of the icon (format _vout). examples: ecb483eda58f26da1b1f8f15b782b1186abdf9c6399a1c3e63e0d429d5092a41_0 or _1");var h=u?BigInt(f.tokens)*Math.pow(10n,BigInt(u)):BigInt(f.tokens),p={p:"bsv-20",op:"deploy+mint",sym:i,icon:n,amt:h.toString()};u&&(p.dec=u.toString());var v=Buffer.from(JSON.stringify(p)).toString("base64"),b={satoshis:1,lockingScript:(new m).lock(l,{dataB64:v,contentType:"application/bsv-20"})};w.addOutput(b);for(var P,S=a(y);!(P=S()).done;){var I=P.value,x={satoshis:I.amount,lockingScript:(new r.P2PKH).lock(I.to)};w.addOutput(x)}var T=0n,B=w.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),O=0,E=function(t,r,n){if("function"==typeof t[ut]){var e,o,i,a=function(t){try{for(;!((e=s.next()).done||n&&n());)if((t=r(e.value))&&t.then){if(!dt(t))return void t.then(a,i||(i=ct.bind(null,o=new ft,2)));t=t.v}o?ct(o,1,t):o=t}catch(t){ct(o||(o=new ft),2,t)}},s=t[ut]();if(a(),s.return){var u=function(t){try{e.done||s.return()}catch(t){}return t};if(o&&o.then)return o.then(u,function(t){throw u(t)});u()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<t.length;f++)c.push(t[f]);return function(t,r,n){var e,o,i=-1;return function a(s){try{for(;++i<t.length&&(!n||!n());)if((s=r(i))&&s.then){if(!dt(s))return void s.then(a,o||(o=ct.bind(null,e=new ft,2)));s=s.v}e?ct(e,1,s):e=s}catch(t){ct(e||(e=new ft),2,t)}}(),e}(c,function(t){return r(c[t])},n)}(c,function(t){var n=t.pk||d;if(!n)throw new Error("Private key is required to sign the payment");var e=k(t,(new r.P2PKH).unlock(n,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return w.addInput(e),T+=BigInt(t.satoshis),Promise.resolve(g.computeFee(w)).then(function(t){O=t,T>=B+BigInt(O)&&(o=1)})},function(){return o||void 0});return E&&E.then?E.then(s):s()},i=t.symbol,s=t.icon,u=t.decimals,c=t.utxos,f=t.initialDistribution,d=t.paymentPk,l=t.destinationAddress,h=t.satsPerKb,p=t.additionalPayments,y=void 0===p?[]:p,g=new r.SatoshisPerKilobyte(void 0===h?v:h),w=new r.Transaction,b=function(){if("string"!=typeof s)return Promise.resolve(function(t){try{var r=t.dataB64,n=t.contentType;if("image/svg+xml"===n)return Promise.resolve(function(t){var r=Buffer.from(t,"base64").toString("utf-8"),n=r.match(/<svg[^>]*\s+width="([^"]+)"/),e=r.match(/<svg[^>]*\s+height="([^"]+)"/);if(!n||!e)return st;var o=Number.parseInt(n[1],10),i=Number.parseInt(e[1],10);return Number.isNaN(o)||Number.isNaN(i)?st:o!==i?it:o>400||i>400?ot:null}(r));if((a=n)!=a)return Promise.resolve(at);try{var e=Uint8Array.from(et(r,"base64")),i=o.imageMeta(e);return Promise.resolve(void 0===i.width||void 0===i.height?st:i.width!==i.height?it:i.width>400||i.height>400?ot:null)}catch(t){return Promise.resolve(at)}}catch(t){return Promise.reject(t)}var a}(s)).then(function(t){if(t)throw t;var r=(new m).lock(l,s);w.addOutput({satoshis:1,lockingScript:r}),n="_0"});n=s}();return Promise.resolve(b&&b.then?b.then(e):e())}catch(t){return Promise.reject(t)}},t.fetchNftUtxos=function(t,n,e,o,i){void 0===e&&(e=10),void 0===o&&(o=0),void 0===i&&(i="base64");try{var a=y+"/txos/address/"+t+"/unspent?limit="+e+"&offset="+o+"&";return n&&(a+="q="+Buffer.from(JSON.stringify({map:{subTypeData:{collectionId:n}}})).toString("base64")),Promise.resolve(fetch(a)).then(function(e){if(!e.ok)throw new Error("Error fetching NFT utxos for "+t);return Promise.resolve(e.json()).then(function(e){var o=(e=e.filter(function(t){var r;return 1===t.satoshis&&!(null!=(r=t.data)&&r.list)})).map(function(t){return t.txid+"_"+t.vout});return Promise.resolve(fetch(y+"/txos/outpoints?script=true",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([].concat(o))})).then(function(o){if(!o.ok)throw new Error("Error fetching NFT scripts for "+t);return Promise.resolve(o.json()).then(function(t){return e=t.map(function(t){var e=t.script;"hex"===i?e=Buffer.from(e,"base64").toString("hex"):"asm"===i&&(e=r.Script.fromHex(Buffer.from(e,"base64").toString("hex")).toASM());var o={origin:t.origin.outpoint,script:e,vout:t.vout,txid:t.txid,satoshis:1};return n&&(o.collectionId=n),o})})})})})}catch(t){return Promise.reject(t)}},t.fetchPayUtxos=function(t,n){void 0===n&&(n="base64");try{var e=y+"/txos/address/"+t+"/unspent?bsv20=false";return console.log({payUrl:e}),Promise.resolve(fetch(e)).then(function(e){if(!e.ok)throw new Error("Error fetching pay utxos");return Promise.resolve(e.json()).then(function(e){e=e.filter(function(t){return 1!==t.satoshis&&!t.lock});var o=b(t),i=(new r.P2PKH).lock(o.data);return e.map(function(t){return{txid:t.txid,vout:t.vout,satoshis:t.satoshis,script:"hex"===n||"base64"===n?Buffer.from(i.toBinary()).toString(n):i.toASM()}})})})}catch(t){return Promise.reject(t)}},t.fetchTokenUtxos=function(r,n,e,o,i){void 0===o&&(o=10),void 0===i&&(i=0);try{return Promise.resolve(fetch(y+"/bsv20/"+e+"/"+(r===t.TokenType.BSV20?"tick":"id")+"/"+n+"?bsv20=true&listing=false&limit="+o+"&offset="+i)).then(function(t){if(!t.ok)throw new Error("Error fetching "+r+" utxos");return Promise.resolve(t.json()).then(function(t){return t.map(function(t){return{amt:t.amt,script:t.script,vout:t.vout,txid:t.txid,id:n,satoshis:1}})})})}catch(t){return Promise.reject(t)}},t.oneSatBroadcaster=function(){return new ht},t.purchaseOrdListing=function(n){try{var e=function(t){var e,a;function s(t){if(f<d+BigInt(l))throw new Error("Not enough funds to purchase ordinal listing. Total sats in: "+f+", Total sats out: "+d+", Fee: "+l);return Promise.resolve(g.fee(y)).then(function(){return Promise.resolve(g.sign()).then(function(){var t=g.outputs.findIndex(function(t){return t.change});if(-1!==t){var r=g.outputs[t];a={satoshis:r.satoshis,txid:g.id("hex"),vout:t,script:Buffer.from(r.lockingScript.toBinary()).toString("base64")}}return a&&(a.satoshis=g.outputs[g.outputs.length-1].satoshis,a.txid=g.id("hex")),{tx:g,spentOutpoints:g.inputs.map(function(t){return t.sourceTXID+"_"+t.sourceOutputIndex}),payChange:a}})})}var u=n.changeAddress||(null==i?void 0:i.toAddress());if(!u)throw new Error("Either changeAddress or paymentPk is required");var c=(new r.P2PKH).lock(u);g.addOutput({lockingScript:c,change:!0});var f=0n,d=g.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),l=0,h=nt(o,function(t){var n=t.pk||i;if(!n)throw new Error("Private key is required to sign the payment");var o=k(t,(new r.P2PKH).unlock(n,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return g.addInput(o),f+=BigInt(t.satoshis),Promise.resolve(y.computeFee(g)).then(function(t){l=t,f>=d+BigInt(l)&&(e=1)})},function(){return e||void 0});return h&&h.then?h.then(s):s()},o=n.utxos,i=n.paymentPk,s=n.listing,u=n.ordAddress,c=n.additionalPayments,f=void 0===c?[]:c,d=n.satsPerKb,l=n.royalties,h=void 0===l?[]:l,p=n.metaData,y=new r.SatoshisPerKilobyte(void 0===d?v:d),g=new r.Transaction;g.addInput(k(s.listingUtxo,(new R).purchaseListing(1,r.Script.fromBinary(r.Utils.toArray(s.listingUtxo.script,"base64"))))),g.addOutput({satoshis:1,lockingScript:(new m).lock(u,void 0,p)});var w=new r.Utils.Reader(r.Utils.toArray(s.payout,"base64")),b=w.readUInt64LEBn().toNumber(),P=w.readVarIntNum(),S=w.read(P),I=r.LockingScript.fromBinary(S);g.addOutput({satoshis:b,lockingScript:I});for(var x,T=a(f);!(x=T()).done;){var B=x.value;g.addOutput({satoshis:B.amount,lockingScript:(new r.P2PKH).lock(B.to)})}var O=nt(h,function(n){var e;function o(t){if(!e)throw new Error("Invalid royalty destination");g.addOutput({satoshis:i,lockingScript:e})}var i=Math.floor(Number(n.percentage)*b),a=function(t,r){var n,e=-1;t:{for(var o=0;o<r.length;o++){var i=r[o][0];if(i){var a=i();if(a&&a.then)break t;if(a===t){e=o;break}}else e=o}if(-1!==e){do{for(var s=r[e][1];!s;)e++,s=r[e][1];var u=s();if(u&&u.then){n=!0;break t}var c=r[e][2];e++}while(c&&!c());return u}}var f=new Z,d=z.bind(null,f,2);return(n?u.then(l):a.then(function n(a){for(;;){if(a===t){e=o;break}if(++o===r.length){if(-1!==e)break;return void z(f,1,u)}if(i=r[o][0]){if((a=i())&&a.then)return void a.then(n).then(void 0,d)}else e=o}do{for(var s=r[e][1];!s;)e++,s=r[e][1];var u=s();if(u&&u.then)return void u.then(l).then(void 0,d);var c=r[e][2];e++}while(c&&!c());z(f,1,u)})).then(void 0,d),f;function l(t){for(;;){var n=r[e][2];if(!n||n())break;e++;for(var o=r[e][1];!o;)e++,o=r[e][1];if((t=o())&&t.then)return void t.then(l).then(void 0,d)}z(f,1,t)}}(n.type,[[function(){return t.RoytaltyType.Paymail},function(){return Promise.resolve(function(){try{throw new Error("Not implemented")}catch(t){return Promise.reject(t)}}()).then(function(t){e=t})}],[function(){return t.RoytaltyType.Script},function(){e=r.Script.fromBinary(r.Utils.toArray(n.destination,"base64"))}],[function(){return t.RoytaltyType.Address},function(){e=(new r.P2PKH).lock(n.destination)}],[void 0,function(){throw new Error("Invalid royalty type")}]]);return a&&a.then?a.then(o):o()},function(){});return Promise.resolve(O&&O.then?O.then(e):e())}catch(t){return Promise.reject(t)}},t.purchaseOrdTokenListing=function(n){try{var e,o=function(t){if(H<_+BigInt(C))throw new Error("Not enough funds to purchase token listing. Total sats in: "+H+", Total sats out: "+_+", Fee: "+C);return Promise.resolve(b.fee(w)).then(function(){return Promise.resolve(b.sign()).then(function(){var t=b.outputs.findIndex(function(t){return t.change});if(-1!==t){var r=b.outputs[t];x={satoshis:r.satoshis,txid:b.id("hex"),vout:t,script:Buffer.from(r.lockingScript.toBinary()).toString("base64")}}return x&&(x.satoshis=b.outputs[b.outputs.length-1].satoshis,x.txid=b.id("hex")),{tx:b,spentOutpoints:b.inputs.map(function(t){return t.sourceTXID+"_"+t.sourceOutputIndex}),payChange:x}})})},i=n.protocol,u=n.tokenID,c=n.utxos,f=n.paymentPk,d=n.listingUtxo,l=n.ordAddress,h=n.satsPerKb,p=n.additionalPayments,y=void 0===p?[]:p,g=n.metaData,w=new r.SatoshisPerKilobyte(void 0===h?v:h),b=new r.Transaction;b.addInput(k(d,(new R).purchaseListing(1,r.Script.fromBinary(r.Utils.toArray(d.script,"base64")))));var P,S={p:"bsv-20",op:"transfer",amt:d.amt};if(i===t.TokenType.BSV20)P=s({},S,{tick:u});else{if(i!==t.TokenType.BSV21)throw new Error("Invalid protocol");P=s({},S,{id:u})}var I=Buffer.from(JSON.stringify(P)).toString("base64");if(b.addOutput({satoshis:1,lockingScript:(new m).lock(l,{dataB64:I,contentType:"application/bsv-20"},g)}),!d.payout)throw new Error("Listing UTXO does not have a payout script");var x,T=new r.Utils.Reader(r.Utils.toArray(d.payout,"base64")),B=T.readUInt64LEBn().toNumber(),O=T.readVarIntNum(),E=T.read(O),A=r.LockingScript.fromBinary(E);b.addOutput({satoshis:B,lockingScript:A});for(var N,K=a(y);!(N=K()).done;){var U=N.value;b.addOutput({satoshis:U.amount,lockingScript:(new r.P2PKH).lock(U.to)})}var j=n.changeAddress||(null==f?void 0:f.toAddress());if(!j)throw new Error("Either changeAddress or paymentPk is required");var q=(new r.P2PKH).lock(j);b.addOutput({lockingScript:q,change:!0});var H=0n,_=b.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),C=0,L=nt(c,function(t){var n=t.pk||f;if(!n)throw new Error("Private key is required to sign the payment");var o=k(t,(new r.P2PKH).unlock(n,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return b.addInput(o),H+=BigInt(t.satoshis),Promise.resolve(w.computeFee(b)).then(function(t){C=t,H>=_+BigInt(C)&&(e=1)})},function(){return e||void 0});return Promise.resolve(L&&L.then?L.then(o):o())}catch(t){return Promise.reject(t)}},t.selectTokenUtxos=function(r,e,o,i){void 0===i&&(i={});for(var s,u=i.inputStrategy,c=void 0===u?t.TokenSelectionStrategy.RetainOrder:u,f=i.outputStrategy,d=void 0===f?t.TokenSelectionStrategy.RetainOrder:f,l=0,h=[],p=a([].concat(r).sort(function(r,n){if(c===t.TokenSelectionStrategy.RetainOrder)return 0;var e=BigInt(r.amt),o=BigInt(n.amt);switch(c){case t.TokenSelectionStrategy.SmallestFirst:return Number(e-o);case t.TokenSelectionStrategy.LargestFirst:return Number(o-e);case t.TokenSelectionStrategy.Random:return Math.random()-.5;default:return 0}}));!(s=p()).done;){var v=s.value;if(h.push(v),(l+=n.toToken(v.amt,o))>=e&&e>0)break}return d!==t.TokenSelectionStrategy.RetainOrder&&h.sort(function(r,n){var e=BigInt(r.amt),o=BigInt(n.amt);switch(d){case t.TokenSelectionStrategy.SmallestFirst:return Number(e-o);case t.TokenSelectionStrategy.LargestFirst:return Number(o-e);case t.TokenSelectionStrategy.Random:return Math.random()-.5;default:return 0}}),{selectedUtxos:h,totalSelected:l,isEnough:l>=e}},t.sendOrdinals=function(t){try{var n,e=function(r){function n(){return Promise.resolve(f.fee(c)).then(function(){return Promise.resolve(f.sign()).then(function(){var t=f.outputs.findIndex(function(t){return t.change});if(-1!==t){var r=f.outputs[t];i={satoshis:r.satoshis,txid:f.id("hex"),vout:t,script:Buffer.from(r.lockingScript.toBinary()).toString("base64")}}return i&&(i.satoshis=f.outputs[f.outputs.length-1].satoshis,i.txid=f.id("hex")),{tx:f,spentOutpoints:d,payChange:i}})})}if(H<_)throw new Error("Not enough ordinals to send");var e=function(){if(t.signer)return Promise.resolve(P(f,t.signer)).then(function(t){f=t})}();return e&&e.then?e.then(n):n()};t.satsPerKb||(t.satsPerKb=v),t.additionalPayments||(t.additionalPayments=[]),void 0===t.enforceUniformSend&&(t.enforceUniformSend=!0);for(var o,i,s=t.ordPk,u=t.paymentPk,c=new r.SatoshisPerKilobyte(t.satsPerKb),f=new r.Transaction,d=[],l=a(t.ordinals);!(o=l()).done;){var h=o.value,p=h.pk||s;if(!p)throw new Error("Private key is required to sign the ordinal");if(1!==h.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var y=k(h,(new m).unlock(p,"all",!0,h.satoshis,r.Script.fromBinary(r.Utils.toArray(h.script,"base64"))));d.push(h.txid+"_"+h.vout),f.addInput(y)}if(t.enforceUniformSend&&t.destinations.length!==t.ordinals.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var g,w=a(t.destinations);!(g=w()).done;){var b,I,x,T=g.value;x=null!=(b=T.inscription)&&b.dataB64&&null!=(I=T.inscription)&&I.contentType?(new m).lock(T.address,T.inscription,S(t.metaData)):(new r.P2PKH).lock(T.address),f.addOutput({satoshis:1,lockingScript:x})}for(var B,K=a(t.additionalPayments);!(B=K()).done;){var U=B.value;f.addOutput({satoshis:U.amount,lockingScript:(new r.P2PKH).lock(U.to)})}var j=t.changeAddress||(null==u?void 0:u.toAddress());if(!j)throw new Error("Either changeAddress or paymentPk is required");var q=(new r.P2PKH).lock(j);f.addOutput({lockingScript:q,change:!0});var H=0n,_=f.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),C=function(t,r,n){if("function"==typeof t[O]){var e,o,i,a=function(t){try{for(;!((e=s.next()).done||n&&n());)if((t=r(e.value))&&t.then){if(!N(t))return void t.then(a,i||(i=E.bind(null,o=new A,2)));t=t.v}o?E(o,1,t):o=t}catch(t){E(o||(o=new A),2,t)}},s=t[O]();if(a(),s.return){var u=function(t){try{e.done||s.return()}catch(t){}return t};if(o&&o.then)return o.then(u,function(t){throw u(t)});u()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<t.length;f++)c.push(t[f]);return function(t,r,n){var e,o,i=-1;return function a(s){try{for(;++i<t.length&&(!n||!n());)if((s=r(i))&&s.then){if(!N(s))return void s.then(a,o||(o=E.bind(null,e=new A,2)));s=s.v}e?E(e,1,s):e=s}catch(t){E(e||(e=new A),2,t)}}(),e}(c,function(t){return r(c[t])},n)}(t.paymentUtxos,function(t){var e=t.pk||u;if(!e)throw new Error("Private key is required to sign the payment");var o=k(t,(new r.P2PKH).unlock(e,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return d.push(t.txid+"_"+t.vout),f.addInput(o),H+=BigInt(t.satoshis),Promise.resolve(c.computeFee(f)).then(function(t){H>=_+BigInt(t)&&(n=1)})},function(){return n||void 0});return Promise.resolve(C&&C.then?C.then(e):e())}catch(t){return Promise.reject(t)}},t.sendUtxos=function(t){try{for(var n,e,o=function(n){if(g<w+b)throw new Error("Not enough funds to send. Total sats in: "+g+", Total sats out: "+w+", Fee: "+b);var e;if(g>w+b){var o=t.changeAddress||(null==s?void 0:s.toAddress());if(!o)throw new Error("Either changeAddress or paymentPk is required");var a=(new r.P2PKH).lock(o),u={lockingScript:a,change:!0};e={txid:"",vout:l.outputs.length,satoshis:0,script:Buffer.from(a.toHex(),"hex").toString("base64")},l.addOutput(u)}else g<w+b&&console.log("No change needed");return Promise.resolve(l.fee(d)).then(function(){return Promise.resolve(l.sign()).then(function(){var t=l.outputs.findIndex(function(t){return t.change});if(-1!==t){var r=l.outputs[t];e={satoshis:r.satoshis,txid:l.id("hex"),vout:t,script:Buffer.from(r.lockingScript.toBinary()).toString("base64")}}return e&&(e.satoshis=l.outputs[l.outputs.length-1].satoshis,e.txid=l.id("hex")),{tx:l,spentOutpoints:i.map(function(t){return t.txid+"_"+t.vout}),payChange:e}})})},i=t.utxos,s=t.paymentPk,u=t.payments,c=t.satsPerKb,f=t.metaData,d=new r.SatoshisPerKilobyte(void 0===c?v:c),l=new r.Transaction,h=a(u);!(e=h()).done;){var p=e.value,y={satoshis:p.amount,lockingScript:(new m).lock(p.to,void 0,f)};l.addOutput(y)}var g=0n,w=l.outputs.reduce(function(t,r){return t+(r.satoshis||0)},0),b=0,P=function(t,r,n){if("function"==typeof t[K]){var e,o,i,a=function(t){try{for(;!((e=s.next()).done||n&&n());)if((t=r(e.value))&&t.then){if(!q(t))return void t.then(a,i||(i=U.bind(null,o=new j,2)));t=t.v}o?U(o,1,t):o=t}catch(t){U(o||(o=new j),2,t)}},s=t[K]();if(a(),s.return){var u=function(t){try{e.done||s.return()}catch(t){}return t};if(o&&o.then)return o.then(u,function(t){throw u(t)});u()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<t.length;f++)c.push(t[f]);return function(t,r,n){var e,o,i=-1;return function a(s){try{for(;++i<t.length&&(!n||!n());)if((s=r(i))&&s.then){if(!q(s))return void s.then(a,o||(o=U.bind(null,e=new j,2)));s=s.v}e?U(e,1,s):e=s}catch(t){U(e||(e=new j),2,t)}}(),e}(c,function(t){return r(c[t])},n)}(i,function(t){var e=t.pk||s;if(!e)throw new Error("Private key is required to sign the utxos");var o=k(t,(new r.P2PKH).unlock(e,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return l.addInput(o),g+=BigInt(t.satoshis),Promise.resolve(d.computeFee(l)).then(function(t){g>=w+(b=t)&&(n=1)})},function(){return n||void 0});return Promise.resolve(P&&P.then?P.then(o):o())}catch(t){return Promise.reject(t)}},t.stringifyMetaData=S,t.transferOrdTokens=function(e){try{var o,i=function(t){function r(){return Promise.resolve(V.fee(M)).then(function(){return Promise.resolve(V.sign()).then(function(){for(var t,r=V.id("hex"),n=a(lt);!(t=n()).done;)t.value.txid=r;var e=V.outputs.findIndex(function(t){return t.change});if(-1!==e){var o=V.outputs[e];dt={satoshis:o.satoshis,txid:r,vout:e,script:Buffer.from(o.lockingScript.toBinary()).toString("base64")}}return dt&&(dt.satoshis=V.outputs[V.outputs.length-1].satoshis,dt.txid=V.id("hex")),{tx:V,spentOutpoints:V.inputs.map(function(t){return t.sourceTXID+"_"+t.sourceOutputIndex}),payChange:dt,tokenChange:lt}})})}if(wt<bt+BigInt(kt))throw new Error("Not enough funds to transfer tokens. Total sats in: "+wt+", Total sats out: "+bt+", Fee: "+kt);var n=function(){if(I)return Promise.resolve(P(V,I)).then(function(t){V=t})}();return n&&n.then?n.then(r):r()},u=e.protocol,c=e.tokenID,f=e.utxos,d=e.inputTokens,l=e.distributions,h=e.paymentPk,p=e.ordPk,y=e.satsPerKb,w=void 0===y?v:y,b=e.metaData,I=e.signer,x=e.decimals,T=e.additionalPayments,B=void 0===T?[]:T,O=e.burn,E=void 0!==O&&O,A=e.tokenInputMode,N=void 0===A?t.TokenInputMode.Needed:A,K=e.splitConfig,U=void 0===K?{outputs:1,omitMetaData:!1}:K;if(!d.every(function(t){return t.id===c}))throw new Error("Input tokens do not match the provided tokenID");var j,q,R=0n,D=0n,F=l.reduce(function(t,r){return t+n.toTokenSat(r.tokens,x,n.ReturnTypes.BigInt)},0n),M=new r.SatoshisPerKilobyte(w),V=new r.Transaction;if(N===t.TokenInputMode.All)q=d,R=d.reduce(function(t,r){return t+BigInt(r.amt)},0n);else{q=[];for(var J,X=a(d);!(J=X()).done;){var W=J.value;if(q.push(W),(R+=BigInt(W.amt))>=F)break}if(R<F)throw new Error("Not enough tokens to satisfy the transfer amount")}for(var G,Y=a(q);!(G=Y()).done;){var Q=G.value,$=Q.pk||p;if(!$)throw new Error("Private key required for token input");var z=r.Utils.toArray(Q.script,"base64"),Z=r.Script.fromBinary(z);V.addInput(k(Q,(new m).unlock($,"all",!0,Q.satoshis,Z)))}if(b)for(var tt=0,rt=Object.keys(b);tt<rt.length;tt++){var nt=rt[tt];void 0===b[nt]&&delete b[nt]}for(var et,ot=a(l);!(et=ot()).done;){var it=et.value,at=n.toTokenSat(it.tokens,x,n.ReturnTypes.BigInt);console.log({distTokenSat:at});var st={p:"bsv-20",op:E?"burn":"transfer",amt:at.toString()},ut=void 0;if(u===t.TokenType.BSV20)ut=s({},st,{tick:c});else{if(u!==t.TokenType.BSV21)throw new Error("Invalid protocol");ut=s({},st,{id:c})}var ct={dataB64:Buffer.from(JSON.stringify(ut)).toString("base64"),contentType:"application/bsv-20"},ft="string"==typeof it.address?(new m).lock(it.address,ct,it.omitMetaData?void 0:S(b)):g(it.address,ct);V.addOutput({satoshis:1,lockingScript:ft}),D+=at}if((j=R-D)<0n)throw new Error("Not enough tokens to send");var dt,lt=[];if(j>0n){var ht=e.tokenChangeAddress||(null==p?void 0:p.toAddress());if(!ht)throw new Error("ordPk or changeAddress required for token change");lt=function(r,e,o,i,a,u,c,f){var d,l=[],h=void 0!==c.threshold?n.toTokenSat(c.threshold,f,n.ReturnTypes.BigInt):void 0,p=c.outputs,v=e;console.log({splitChangeAmt:v}),void 0!==h&&h>0n?(d=v/h,d=BigInt(Math.min(Number(d),p))):d=BigInt(p);for(var y=v/(d=BigInt(Math.max(Number(d),1))),g=v%d,w=0n;w<d;w++){var b=y;g>0n&&(b+=1n,g-=1n);var k={p:"bsv-20",op:"transfer",amt:b.toString()},P=void 0;if(o===t.TokenType.BSV20)P=s({},k,{tick:i});else{if(o!==t.TokenType.BSV21)throw new Error("Invalid protocol");P=s({},k,{id:i})}var I=(new m).lock(a,{dataB64:Buffer.from(JSON.stringify(P)).toString("base64"),contentType:"application/bsv-20"},c.omitMetaData?void 0:S(u)),x=r.outputs.length;r.addOutput({lockingScript:I,satoshis:1}),l.push({id:i,satoshis:1,script:Buffer.from(I.toBinary()).toString("base64"),txid:"",vout:x,amt:b.toString()})}return l}(V,j,u,c,ht,b,U,x)}for(var pt,vt=a(B);!(pt=vt()).done;){var yt=pt.value;V.addOutput({satoshis:yt.amount,lockingScript:(new r.P2PKH).lock(yt.to)})}var mt=e.changeAddress||(null==h?void 0:h.toAddress());if(!mt)throw new Error("paymentPk or changeAddress required for payment change");var gt=(new r.P2PKH).lock(mt);V.addOutput({lockingScript:gt,change:!0});var wt=0n,bt=V.outputs.reduce(function(t,r){return t+BigInt(r.satoshis||0)},0n),kt=0,Pt=function(t,r,n){if("function"==typeof t[H]){var e,o,i,a=function(t){try{for(;!((e=s.next()).done||n&&n());)if((t=r(e.value))&&t.then){if(!L(t))return void t.then(a,i||(i=_.bind(null,o=new C,2)));t=t.v}o?_(o,1,t):o=t}catch(t){_(o||(o=new C),2,t)}},s=t[H]();if(a(),s.return){var u=function(t){try{e.done||s.return()}catch(t){}return t};if(o&&o.then)return o.then(u,function(t){throw u(t)});u()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var c=[],f=0;f<t.length;f++)c.push(t[f]);return function(t,r,n){var e,o,i=-1;return function a(s){try{for(;++i<t.length&&(!n||!n());)if((s=r(i))&&s.then){if(!L(s))return void s.then(a,o||(o=_.bind(null,e=new C,2)));s=s.v}e?_(e,1,s):e=s}catch(t){_(e||(e=new C),2,t)}}(),e}(c,function(t){return r(c[t])},n)}(f,function(t){var n=t.pk||h;if(!n)throw new Error("paymentPk required for payment utxo");var e=k(t,(new r.P2PKH).unlock(n,"all",!0,t.satoshis,r.Script.fromBinary(r.Utils.toArray(t.script,"base64"))));return V.addInput(e),wt+=BigInt(t.satoshis),Promise.resolve(M.computeFee(V)).then(function(t){kt=t,wt>=bt+BigInt(kt)&&(o=1)})},function(){return o||void 0});return Promise.resolve(Pt&&Pt.then?Pt.then(i):i())}catch(t){return Promise.reject(t)}},t.validateSubTypeData=function(t,r){try{if("collection"===t){var n=r;if(!n.description)return new Error("Collection description is required");if(!n.quantity)return new Error("Collection quantity is required");if(n.rarityLabels){if(!Array.isArray(n.rarityLabels))return new Error("Rarity labels must be an array");if(!n.rarityLabels.every(function(t){return Object.values(t).every(function(t){return"string"==typeof t})}))return new Error("Invalid rarity labels "+n.rarityLabels)}if(n.traits){if("object"!=typeof n.traits)return new Error("Collection traits must be an object");if(n.traits&&!Object.keys(n.traits).every(function(t){return"string"==typeof t&&"object"==typeof n.traits[t]}))return new Error("Collection traits must be a valid CollectionTraits object")}}if("collectionItem"===t){var e=r;if(!e.collectionId)return new Error("Collection id is required");if(!e.collectionId.includes("_"))return new Error("Collection id must be a valid outpoint");if(64!==e.collectionId.split("_")[0].length)return new Error("Collection id must contain a valid txid");if(Number.isNaN(Number.parseInt(e.collectionId.split("_")[1])))return new Error("Collection id must contain a valid vout");if(e.mintNumber&&"number"!=typeof e.mintNumber)return new Error("Mint number must be a number");if(e.rank&&"number"!=typeof e.rank)return new Error("Rank must be a number");if(e.rarityLabel&&"string"!=typeof e.rarityLabel)return new Error("Rarity label must be a string");if(e.traits&&"object"!=typeof e.traits)return new Error("Traits must be an object");if(e.attachments&&!Array.isArray(e.attachments))return new Error("Attachments must be an array")}return}catch(t){return new Error("Invalid JSON data")}}});
//# sourceMappingURL=index.umd.js.map
